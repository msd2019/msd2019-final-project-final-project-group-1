---
title: 'MSD Final Project Report'
author: 'Forrest Hofmann (fhh2112) & Sagar Lal (sl3946)'
date: '`r Sys.time()`'
output:
  pdf_document:
    toc: yes
    toc_depth: 3
---

```{r setup, include=FALSE}
library(here)
library(tidyverse)
library(scales)

theme_set(theme_bw())

knitr::opts_chunk$set(echo = TRUE)
```

# Introduction

## Problem Description

## Motivation

## Data Source


# Reproduction

## Reproduction Code

```{r load-data}
teams <- read_csv(here('teams.csv'))
salaries <- read_csv(here('salaries.csv'))
```

```{r clean-old-data}
teams_old <- teams %>%
  filter(1985 <= yearID & yearID <= 1998) %>%
  mutate(winPercentage = W / (W + L) * 1000) %>%
  mutate(normalizedYear = yearID - 1985)

salaries_old <- salaries %>%
  filter(1985 <= yearID & yearID <= 1998) %>%
  mutate(salaryMil = salary / 1000000)
```

```{r compute-team-salary-total}
teams_old <- teams_old %>%
  inner_join(salaries_old) %>%
  group_by(yearID, teamID, G, W, L, winPercentage, normalizedYear) %>%
  summarize(totalSalaryMil = sum(salaryMil))
```

```{r compute-player-salary-share}
salaries_old <- salaries_old %>% 
  inner_join(teams_old) %>%
  mutate(salaryShare = salaryMil / totalSalaryMil * 100) %>%
  mutate(salaryShareSquared = salaryShare ^ 2) %>%
  select(yearID, teamID, playerID, salary, salaryShare, salaryShareSquared)
```

```{r compute-team-salary-hhi}
teams_old <- teams_old %>%
  inner_join(salaries_old) %>%
  group_by(yearID, teamID, G, W, L, winPercentage, totalSalaryMil, normalizedYear) %>%
  summarize(HHI = sum(salaryShareSquared))
```

```{r summary-statistics}
summary(teams_old$winPercentage)
summary(teams_old$totalSalaryMil)
summary(teams_old$HHI)
```

```{r linear-fixed-effects-regression}
linear_fixed_old <- lm(formula = winPercentage ~ totalSalaryMil + HHI + normalizedYear + teamID + 0,
                       data = teams_old)
summary(linear_fixed_old)$coefficients
```

```{r linear-random-effects-regression}
linear_random_old <- lm(formula = winPercentage ~ totalSalaryMil + HHI + normalizedYear,
                        data = teams_old)
summary(linear_random_old)$coefficients
```

```{r log-log-fixed-effects-regression}
log_log_fixed_old <- lm(formula = log(winPercentage) ~ log(totalSalaryMil) + log(HHI) + normalizedYear + teamID + 0,
                        data = teams_old)
summary(log_log_fixed_old)$coefficients
```

```{r log-log-random-effects-regression}
log_log_random_old <- lm(formula = log(winPercentage) ~ log(totalSalaryMil) + log(HHI) + normalizedYear,
                         data = teams_old)
summary(log_log_random_old)$coefficients
```

## Reproduction Notes

- original author did not describe how time fixed effects are accounted for (across expansion periods or every year)
- no discussion about limiting to 25 man roster vs 40 man roster
- no discussion of cut players, traded players
- no discussion of signing bonuses

## Reproduction Analysis


# Extension

## Extension Code

```{r statistic-distributions}
# TODO: plot distribution of win percentage, total salary, HHI
```

## Extension Notes

## Extension Analysis